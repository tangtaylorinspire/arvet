!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";var i,o,a,r;function l(){(i=new THREE.WebGLRenderer).setSize(window.innerWidth,window.innerHeight),i.setPixelRatio(window.devicePixelRatio),i.domElement.id="vessel",document.body.insertBefore(i.domElement,document.body.firstChild),(o=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.1,1e3)).position.z=-50,(a=new THREE.Scene).background=new THREE.Color(9109504);var e=new THREE.CylinderBufferGeometry(10,10,40,32),t=new THREE.MeshBasicMaterial({color:16711680,transparent:!0,opacity:.1,side:THREE.DoubleSide}),n=new THREE.Mesh(e,t);a.add(n),n.rotation.z=Math.PI/2,r=new THREE.Group;for(var l=0;l<10;l++){var s=new THREE.Group,c=new THREE.TorusBufferGeometry(1,1,15,30),y=new THREE.MeshBasicMaterial({color:16711680}),p=new THREE.LineBasicMaterial({color:16731212}),m=new THREE.LineSegments(c,p),u=new THREE.Mesh(c,y);m.position.set(40*Math.random()-20,7.5*Math.random()-3.75,7.5*Math.random()-3.75),u.position.set(m.position.x,m.position.y,m.position.z),u.rotation.x=m.rotation.x=Math.PI/2,u.rotation.y=m.rotation.y=Math.random()*Math.PI,s.add(m),s.add(u),r.add(s)}a.add(r),a.add(new THREE.AmbientLight(16777215)),new THREE.OrbitControls(o),window.addEventListener("resize",d,!1)}function d(){o.aspect=window.innerWidth/window.innerHeight,o.updateProjectionMatrix(),i.setSize(window.innerWidth,window.innerHeight)}function s(){requestAnimationFrame(s);for(var e=0;e<10;e++)r.children[e].children[0].position.x+=.05*Math.random(),r.children[e].children[1].position.x=r.children[e].children[0].position.x,r.children[e].children[0].rotation.x+=.025*Math.random(),r.children[e].children[1].rotation.x=r.children[e].children[0].rotation.x,r.children[e].children[0].rotation.y+=.025*Math.random(),r.children[e].children[1].rotation.y=r.children[e].children[0].rotation.y,r.children[e].children[0].position.x>19&&(r.children[e].children[0].position.x=-19,r.children[e].children[1].position.x=-19);i.render(a,o)}Object.defineProperty(t,"__esModule",{value:!0}),t.start=function(){l(),s()},t.init=l,t.onWindowResize=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findObjEvt=function(e,t,n,i){e.preventDefault();var o=getComputedStyle(e.target),a=o.getPropertyValue("transform"),r=o.getPropertyValue("transform-origin").replace(/px/g,"").split(" ");r[0]=parseFloat(r[0]),r[1]=parseFloat(r[1]),r[2]=parseFloat(r[2]||0);var l=new THREE.Matrix4;if(l.identity(),/^matrix\(/.test(a)){var d=a.replace(/^matrix\(|\)$/g,"").split(" ");l.elements[0]=parseFloat(d[0]),l.elements[1]=parseFloat(d[1]),l.elements[4]=parseFloat(d[2]),l.elements[5]=parseFloat(d[3]),l.elements[12]=parseFloat(d[4]),l.elements[13]=parseFloat(d[5])}else if(/^matrix3d\(/i.test(a))for(var d=a.replace(/^matrix3d\(|\)$/gi,"").split(" "),s=0;s<16;s++)l.elements[s]=parseFloat(d[s]);var c=new THREE.Matrix4;c.makeTranslation(r[0],r[1],r[2]),c.multiply(l),l.makeTranslation(-r[0],-r[1],-r[2]),c.multiply(l);var y=new THREE.Vector3(e.layerX,e.layerY,0);y.applyMatrix4(c);var p=parseFloat(o.getPropertyValue("width")),m=parseFloat(o.getPropertyValue("height")),u=new THREE.Vector3(y.x/p*2-1,-y.y/m*2+1,.5);u.unproject(t),u.sub(t.position),u.normalize();var h=new THREE.Raycaster(t.position,u);if(0==i)var E=h.intersectObject(n);else if(1==i)var E=h.intersectObjects(n.children,!0);if(E.length>0){var g=E;return g}}},function(e,t,n){"use strict";var i,o,a,r,l,d,s=n(1),c=n(0);var y,p,m=!1,u=!1,h=!1,E=null,g=new THREE.Clock,v=.03,f={color:16777215,scale:4,flowX:1,flowY:1,waterColor:"rgba(12, 132, 230, 0.8)",antialias:!1};function w(e,t,n){e.camera,t.setPatternDetectionMode(artoolkit.AR_TEMPLATE_MATCHING_MONO_AND_MATRIX),d=f.waterColor,(a=new THREE.Scene).background=new THREE.Color(16777215),e.scene.clearColor=new THREE.Color(16777215);var w=new THREE.PointLight(16777215);e.scene.add(w);var I=new THREE.LoadingManager;I.onProgress=function(e,t,n){console.log(e,t,n);var i=document.getElementById("plainBg");i.style.opacity=0,i.style.visibility="hidden",i.style.transition="opacity 1s, visibility 1s",/Android|mobile|iPad|iPhone/i.test(navigator.userAgent)&&(document.getElementById("overlayDetect").style.display="none")};var R=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;console.log(Math.round(t,2)+"% downloaded"),document.getElementById("loading").innerHTML=Math.round(t,1)+"%"}},H=function(e){},P=new THREE.OBJLoader2(I);document.body.className=t.orientation,(i=new THREE.WebGLRenderer({antialias:f.antialias,alpha:!0,powerPreference:"low-power",autoClear:!0})).setClearColor(16777215),i.setPixelRatio(window.devicePixelRatio);var _=window.innerWidth,k=window.innerHeight,O=window.screen.orientation.type,C=!1;if(/Android|mobile|iPad|iPhone/i.test(navigator.userAgent)?(document.body.className+=" phone",k>_?b(k,_,e,i):b(_,k,e,i)):k>_||"portrait"===t.orientation||"portrait-secondary"===O||"portrait-primary"===O?(document.getElementById("overlayDetect").style.display="block",C=!0):(b(_,k,e,i),document.body.className+=" desktop"),!1===f.antialias?i.domElement.id="SD":i.domElement.id="HD",document.body.insertBefore(i.domElement,document.body.firstChild),window.addEventListener("resize",function(){k>_&&!/Android|mobile|iPad|iPhone/i.test(navigator.userAgent)?document.getElementById("overlayDetect").style.display="block":!0===C?location.reload():!1===C&&(b(_,k,e,i),document.getElementById("overlayDetect").style.display="none")}),window.addEventListener("orientationchange",function(){var e=window.screen.orientation.type;"portrait-secondary"===e||"portrait-primary"===e?document.getElementById("overlayDetect").style.display="block":"landscape-primary"!==e&&"landscape-secondary"!==e||(document.getElementById("overlayDetect").style.display="none")}),!1===m){for(var D=[{buttonID:"OverlayWater",materialType:"Water"},{buttonID:"OverlayMilk",materialType:"Milk"},{buttonID:"OverlayJuice",materialType:"Orange Juice"}],j=0;j<D.length;j++)!function(e){document.getElementById(D[e].buttonID).addEventListener("click",function(t){x(a,D[e].materialType)},!1)}(j);document.getElementById("hdBtn").addEventListener("click",function(n){var o;if(o=1==f.antialias?document.getElementById("HD"):document.getElementById("SD")){i.dispose(),1==f.antialias?document.getElementById("hdBtn").style.backgroundColor="rgba(192, 192, 192, 0.8)":document.getElementById("hdBtn").style.backgroundColor="rgba(255, 165, 000, 0.8)",f.antialias=!f.antialias;var r=document.getElementById("plainBg");r.style.opacity=1,r.style.visibility="visible",r.style.transition="opacity 1s, visibility 1s",cancelAnimationFrame(y),null,null,e=null,t=null,a=null,i=null,o.remove(),ARThreeOnLoad()}n.preventDefault()},!1),document.getElementById("overlayIDU").addEventListener("click",function(e){var t=document.getElementById("overlayUreter");t.style.opacity=0,t.style.right="-100%",t.style.transition="right 1s, opacity 1s",t.style.removeProperty("width"),A("Main_Kidney",1,!0),document.getElementById("ureterVideo").src="",!0===p&&W()},!1),document.getElementById("overlayIDK").addEventListener("click",function(e){var t=document.getElementById("overlayKindney");t.style.opacity=0,t.style.right="-100%",t.style.transition="right 1s, opacity 1s",t.style.removeProperty("width"),A("Ureter_mesh",.5,!0),document.getElementById("kidneyVideo").src=""},!1),document.getElementById("shLabel").addEventListener("click",function(e){u=!u,document.getElementById("shLabel").style.backgroundColor=!1===u?"rgba(192, 192, 192, 0.8)":"rgba(255, 0, 0, 0.8)",e.preventDefault()},!1),document.getElementById("overlayZoom").addEventListener("click",function(e){W()},!1),m=!0}function W(){p=!p;var e=document.getElementById("curtain"),t=document.getElementById("overlayZoom"),n=document.getElementById("overlayIDU");e.style.opacity=1,e.style.right="0%",e.style.transition="opacity 3s",t.disabled=!0,n.disabled=!0,setTimeout(function(){if(p)(0,c.start)();else if(!p){document.getElementById("vessel").remove(),$("#overlayIDU").tooltip("hide"),$("#overlayZoom").tooltip("hide")}e.style.opacity=0,e.style.transition="opacity 3s"},3e3),setTimeout(function(){t.disabled=!1,n.disabled=!1,e.style.right="100%"},6e3),event.preventDefault()}function A(e,t,n){var i=a.getObjectByName(e);"Main_Kidney"===e?i.children[0].traverse(function(e){e.material.transparent=!0,e.material.opacity=t}):"Ureter_mesh"===e&&!0===n?(i.material.transparent=!1,i.material.opacity=t,x(a,"reset")):"Ureter_mesh"===e&&!1===n&&(i.material.transparent=!0,i.material.opacity=t)}i.domElement.addEventListener("click",function(t){if(n=(0,s.findObjEvt)(t,e.camera,a,1))for(var n=(0,s.findObjEvt)(t,e.camera,a,1),i=0;i<n.length;i++){if("MainKidney"===n[i].object.name){B(),A("Ureter_mesh",.1,!1);break}if("Ureter_mesh"===n[i].object.name){M(),A("Main_Kidney",.3,!1);break}}},!1),P.load("./model/kidney_part1.obj",function(e){if(e.traverse(function(e){e instanceof THREE.Mesh&&(e.material.transparent=!0)}),e.name="Main_Kidney",e.rotation.set(90*Math.PI/180,20*Math.PI/180,0),k>_){var t=k/_;e.scale.set(.03*t,.03,.03)}else e.scale.set(.03,.03,.03);a.add(e),e},R,H);var L=new THREE.Object3D;function S(e,t){var n=new THREE.Vector3,o=.5*i.context.canvas.width,a=.5*i.context.canvas.height;return e.updateMatrixWorld(),n.applyMatrix4(e.matrixWorld),n.project(t),n.x=n.x*o+o,n.y=-n.y*a+a,{x:n.x,y:n.y}}L.name="ureterGroup",P.load("./model/kidney_part2.obj",function(e){if(e.traverse(function(e){!function(e){if(e instanceof THREE.Mesh){l=e.geometry.clone(),r=new THREE.Water(e.geometry.clone(),(d={color:f.color,scale:f.scale,flowDirection:new THREE.Vector2(f.flowX,f.flowY),textureWidth:1024},c=1024,(s="textureWidth")in d?Object.defineProperty(d,s,{value:c,enumerable:!0,configurable:!0,writable:!0}):d[s]=c,d)),E=T();var t=new THREE.MeshBasicMaterial({map:E,side:THREE.DoubleSide,depthWrite:!0,depthTest:!0,transparent:!0,opacity:.5}),n=new THREE.Mesh(l,t);n.renderOrder=1,n.rotation.set(90*Math.PI/180,20*Math.PI/180,0);var i=new THREE.BoxHelper(n,16711680);i.update(),r.rotation.set(90*Math.PI/180,20*Math.PI/180,0);var o=new THREE.BoxHelper(r,16711680);o.update(),n.geometry.computeBoundingBox();var a=n.geometry.boundingBox.getCenter();a.applyMatrix4(n.matrixWorld),n.position.set(a.x,a.y,a.z),n.geometry.center(),r.name="Ureter",n.name="Ureter_mesh",L.add(r),L.add(n),L.scale.set(.03,.03,.03)}var d,s,c}(e)}),r.rotation.set(90*Math.PI/180,20*Math.PI/180,0),e.rotation.set(90*Math.PI/180,20*Math.PI/180,0),k>_){var t=k/_;e.scale.set(.03*t,.03,.03)}else e.scale.set(.03,.03,.03);e},R,H),a.add(L),t.loadMarker("Data/patt.bigpeeBoyWBlack",function(n){(o=t.createThreeMarker(n)).add(a),e.scene.add(o)}),t.addEventListener("getMarker",function(e){-1===e.data.type?h=!1:0===e.data.type&&(h=!0)});!function t(){e.process(),e.renderOn(i),y=requestAnimationFrame(t);var n=g.getDelta();g.getElapsedTime();if(null!==E&&(E.offset.y-=2*n,E.offset.x-=n),!0===u&&g.elapsedTime%.1>=.05&&!0===h){var o=S(a.getObjectByName("Main_Kidney"),e.camera);document.getElementById("label_tip_K").style.top=o.y+"px",document.getElementById("label_tip_K").style.left=o.x+"px",$("#label_tip_K").tooltip("show"),o=S(a.getObjectByName("Ureter_mesh"),e.camera),document.getElementById("label_tip_U").style.top=o.y+"px",document.getElementById("label_tip_U").style.left=o.x+"px",$("#label_tip_U").tooltip("show")}else!1!==u&&!1!==h||($("#label_tip_U").tooltip("hide"),$("#label_tip_K").tooltip("hide"));if(!0===p){var r=function(e){new THREE.BoxHelper(e,16711680).update(),e.geometry.computeBoundingBox();var t=e.geometry.boundingBox.getCenter();return t.applyMatrix4(e.matrixWorld),t}(a.getObjectByName("Ureter_mesh"));v<=.5&&(v+=.003,a.getObjectByName("Main_Kidney").scale.set(v,v,v),a.getObjectByName("ureterGroup").scale.set(v,v,v),r.x+=1.5),r.x<0?r.x.toFixed(2)>-.09?a.position.x=0:a.position.x=a.position.x+.09:r.x>0&&(r.x.toFixed(2)<.09?a.position.x=0:a.position.x=a.position.x-.09),r.y<0?r.y.toFixed(2)>-.09?a.position.y=0:a.position.y=a.position.y+.09:r.y>0&&(r.x.toFixed(2)<.09?a.position.y=0:a.position.y=a.position.y-.09)}else!1===p&&(v>.03&&(v-=.003,a.getObjectByName("Main_Kidney").scale.set(v,v,v),a.getObjectByName("ureterGroup").scale.set(v,v,v)),a.position.x<0?a.position.x.toFixed(2)>-.09?a.position.x=a.position.x:a.position.x=a.position.x+.09:a.position.x>0&&(a.position.x.toFixed(2)<.09?a.position.x=a.position.x:a.position.x=a.position.x-.09),a.position.y<0?a.position.y.toFixed(2)>-.09?a.position.y=a.position.y:a.position.y=a.position.y+.09:a.position.y>0&&(a.position.y.toFixed(2)<.09?a.position.y=a.position.y:a.position.y=a.position.y-.09))}()}function b(e,t,n,i){var o=t/n.video.videoHeight,a=e/n.video.videoWidth;t>=e?i.setSize(n.video.videoWidth*o,t,!1):e>=t&&(a*n.video.videoHeight<t?i.setSize(n.video.videoWidth*o,t,!1):i.setSize(e,a*n.video.videoHeight,!1))}function x(e,t){switch(t){case"Water":d=f.waterColor,f.waterColor="rgba(12, 132, 230, 0.8)";break;case"Milk":d=f.waterColor,f.waterColor="rgba(220, 217, 205, 0.8)";break;case"Orange Juice":d=f.waterColor,f.waterColor="rgba(255, 127, 51,0.8)";break;case"reset":f.waterColor=d;break;default:console.log("error")}e.getObjectByName("Ureter_mesh").traverse(function(e){E=T();var t=new THREE.MeshBasicMaterial({map:E,side:THREE.DoubleSide,depthWrite:!0,depthTest:!0,transparent:!0,opacity:.5});e.material=t})}function B(){var e=document.getElementById("overlayKindney"),t=document.getElementById("overlayUreter");t.style.opacity=0,t.style.right="-100%",t.style.transition="right 1s, opacity 1s",t.style.removeProperty("width"),/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)&&(e.style.width="100%",e.style.height="50%",e.style.top="50%"),e.style.opacity=1,e.style.right=0,e.style.transition="opacity 1s, right 1s",document.getElementById("kidneyVideo").src="https://www.youtube.com/embed/FN3MFhYPWWo?enablejsapi=1"}function M(){var e=document.getElementById("overlayKindney"),t=document.getElementById("overlayUreter");e.style.opacity=0,e.style.right="-100%",e.style.transition="right 1s, opacity 1s",e.style.removeProperty("width"),/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)&&(t.style.width="100%",t.style.height="50%",t.style.top="50%"),t.style.opacity=1,t.style.right=0,t.style.transition="opacity 1s, right 1s",document.getElementById("ureterVideo").src="https://www.youtube.com/embed/-yfuSrt-0Uk?enablejsapi=1"}function T(){var e=document.createElement("canvas").getContext("2d"),t=null;return e.canvas.width=64,e.canvas.height=64,e.fillStyle=f.waterColor,e.fillRect(0,0,64,64),e.translate(8,8),e.rotate(.5*Math.PI),e.fillStyle="rgb(255,255,255)",e.textAlign="center",e.textBaseline="middle",e.font="64px sans-serif",e.fillText("•",0,0),(t=new THREE.CanvasTexture(e.canvas)).wrapS=THREE.RepeatWrapping,t.wrapT=THREE.RepeatWrapping,t.repeat.x=1,t.repeat.y=1,t.offset.x=0,t.offset.y=0,t}window.ARThreeOnLoad=function(){navigator.mediaDevices.enumerateDevices().then(function(e){var t=e.find(function(e){return-1!==e.label.indexOf("back")});!function(e){ARController.getUserMediaThreeScene({maxARVideoSize:640,cameraParam:"Data/camera_para-iPhone 6 Plus rear 1280x720 1.0m.dat",deviceId:e.deviceId,facing:"environment",onSuccess:w})}({deviceId:t?{exact:t.deviceId}:void 0})}).catch(function(e){alert(e.name+": "+e.message)})},window.ARController&&ARController.getUserMediaThreeScene&&ARThreeOnLoad()}]);